
var Participate=Page.extend({color:null,soundArray:null,init:function(){arguments.callee.$.init.call(this);},buildObjects:function(){arguments.callee.$.buildObjects.call(this);},buildHandlers:function(){arguments.callee.$.buildHandlers.call(this);},start:function(){console.log(Global.pageData);arguments.callee.$.start.call(this);this.initScene();},resize:function(){arguments.callee.$.resize.call(this);},changeResolution:function(){arguments.callee.$.changeResolution.call(this);},initScene:function(){var _this=this;_this.soundArray=[];$("#inner-content").html('<div id = "CreateCairo"></div>');$("#CreateCairo").append('<div id = "CairoBackgroundHolder"></div>');$("#CreateCairo").append('<div id = "SoundPulseHolder"></div>');$("#CreateCairo").append('<div id = "AudioHolder"></div>');$("#CreateCairo").css({"position":"absolute","width":"100%","height":"100%","overflow-x":"hidden","overflow-y":"hidden"});$("#CairoBackgroundHolder").css({"position":"absolute","width":"100%","height":"100%"});var audioEmbed="";audioEmbed+='<audio id ="ambientNoise">';audioEmbed+='<source src="asset/sound/create/ambient.mp3" type="audio/mpeg">';audioEmbed+='<source src="asset/sound/create/ambient.ogg" type="audio/ogg">';audioEmbed+='<embed src="asset/sound/create/ambient.mp3">';audioEmbed+='</audio>';$("#AudioHolder").append(audioEmbed);var audioObj=$("#ambientNoise").get(0);audioObj.addEventListener("ended",this.audioEnded);audioObj.play();audioObj.volume=1;document.body.style.background='#fbfbfb';this.loadImage();$("#CairoBackgroundHolder").css({"position":"absolute"});$("#CreateCairo").click(function(e){_this.spawnSound(e)});},audioEnded:function(e){e.currentTarget.currentTime=0;e.currentTarget.play();},loadImage:function(){$("#CairoBackgroundHolder").css({'background-image':'url("asset/img/Cairo_0'+Math.round(Math.random()*3+1)+'.png")','background-size':'100%','background-repeat':'no-repeat','background-position':'center bottom'});},spawnSound:function(e){var _this=this;if(_this.soundArray.length>20){_this.soundArray[_this.soundArray.length-1].pause();_this.soundArray.splice(_this.soundArray.length-1,1);}
console.log("sounds are",_this.soundArray.length);var audioID=Math.round(Math.random()*12)+1;var id=new Date().getTime();var audioEmbed="";audioEmbed+='<audio id ="'+id+'">';audioEmbed+='<source src="asset/sound/create/'+audioID+'.mp3" type="audio/mpeg">';audioEmbed+='<source src="asset/sound/create/'+audioID+'.ogg" type="audio/ogg">';audioEmbed+='<embed src="asset/sound/create/'+audioID+'.mp3">';audioEmbed+='</audio>';$("#AudioHolder").append(audioEmbed);var audioObj=$("#"+id).get(0);audioObj.play();audioObj.volume=.5;setTimeout(function(){_this.createPulse(e.pageX,e.pageY,"#"+id);},0)
_this.soundArray.push(audioObj);$(".instructions").fadeOut();},createPulse:function(__mouseX,__mouseY,__id){var _this=this;var pointer=$('<dom>.</dom>');$("#SoundPulseHolder").append(pointer);_this.color=(0x3ec8dd).toString(16);var finalRadius=600;pointer.css({width:'10px',height:'10px',opacity:1,position:"absolute",'background-color':'#'+_this.color,'border-radius':'2000px','-moz-border-radius':'2000px','-webkit-border-radius':'2000px','z-index':-1,top:__mouseY,left:__mouseX}).show().animate({height:(finalRadius+'px'),width:(finalRadius+'px'),'border-radius':(finalRadius+'px'),'-moz-border-radius':(finalRadius+'px'),'-webkit-border-radius':(finalRadius+'px'),opacity:0,top:__mouseY-finalRadius/2,left:__mouseX-finalRadius/2},2000,function(){$(this).remove();console.log("is paused?!",$(__id).get(0).paused);if(!$(__id).get(0).paused)_this.createPulse(__mouseX,__mouseY,__id);else $(__id).remove();});}});Global.page=new Participate();;